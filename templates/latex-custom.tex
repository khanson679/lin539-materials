%
% Custom LaTeX template for LIN 539 course notes
% At present, still includes some extraneous content from the
%   default Pandoc tempalte
%
% Use variable `singlechapter` when compiling individual chapters
%

$if(singlesection)$
\documentclass[11pt]{article}
$elseif(singlechapter)$
\documentclass[11pt]{article}
$else$
\documentclass[11pt,oneside]{book}
$endif$

\usepackage[hmargin=1.5in, vmargin=1in, letterpaper, includeheadfoot,
            headheight=14pt]{geometry}
\usepackage[T1]{fontenc}
\usepackage{charter}

\usepackage{titletoc}
\contentsmargin{2em}
\dottedcontents{section}[2.5em]{}{2.5em}{8pt}
\dottedcontents{subsection}[5em]{}{3em}{8pt}
\dottedcontents{subsubsection}[8.5em]{}{3.5em}{8pt}

\usepackage{fancyhdr}
\fancyhead[L]{Thomas Graf, Fall 2021}
\fancyhead[R]{\nouppercase{\leftmark}}
\pagestyle{fancy}

\raggedbottom

% \titlecontents{section}
% [3.8em] % left margin
% {} % above code
% {\contentslabel{2.3em}} % numbered format
% {\hspace*{-2.3em}} % numberless format
% {\titlerule*[6pt]{.}\contentspage} % filler format

% \usepackage{tikz}
% \usetikzlibrary{external}
% \tikzexternalize[prefix=cache/]

% \usepackage{amssymb,amsmath}

% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[$for(microtypeoptions)$$microtypeoptions$$sep$,$endfor$]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}

\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
$if(title-meta)$
  pdftitle={$title-meta$},
$endif$
$if(author-meta)$
  pdfauthor={$author-meta$},
$endif$
$if(lang)$
  pdflang={$lang$},
$endif$
$if(subject)$
  pdfsubject={$subject$},
$endif$
$if(keywords)$
  pdfkeywords={$for(keywords)$$keywords$$sep$, $endfor$},
$endif$
$if(colorlinks)$
  colorlinks=true,
  linkcolor=$if(linkcolor)$$linkcolor$$else$Maroon$endif$,
  filecolor=$if(filecolor)$$filecolor$$else$Maroon$endif$,
  citecolor=$if(citecolor)$$citecolor$$else$Blue$endif$,
  urlcolor=$if(urlcolor)$$urlcolor$$else$Blue$endif$,
$else$
  hidelinks,
$endif$
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs

% Pandoc-supplied macros for code highlighting
$if(highlighting-macros)$
$highlighting-macros$
$endif$

$if(tables)$
\usepackage{longtable,booktabs}
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
$endif$

$if(graphics)$
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
$endif$

$if(links-as-notes)$
% Make links footnotes instead of hotlinks:
\DeclareRobustCommand{\href}[2]{#2\footnote{\url{#1}}}
$endif$

$if(strikeout)$
\usepackage[normalem]{ulem}
% Avoid problems with \sout in headers with hyperref
\pdfstringdefDisableCommands{\renewcommand{\sout}{}}
$endif$

\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

$if(numbersections)$
\setcounter{secnumdepth}{$if(secnumdepth)$$secnumdepth$$else$5$endif$}
$else$
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
$endif$

$if(pagestyle)$
\pagestyle{$pagestyle$}
$endif$

% Pandoc include-in-header
$for(header-includes)$
$header-includes$
$endfor$

% Code for selective inclusion of answers
%   Variable "showanswers" controls collection
%   Macro \exranswerlist contains answers
$if(showanswers)$
\usepackage{etoolbox}
\providebool{showanswers}
\setbool{showanswers}{$showanswers$}
$endif$

% Code for document metadata
$if(title)$
\title{$title$}
$endif$

$if(subtitle)$
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother
\subtitle{$subtitle$}
$endif$

\author{$for(author)$$author$$sep$ \and $endfor$}
\date{$date$}

%----------------------------------------------------------------------------
\begin{document}

$if(singlesection)$
$if(title)$
{\centering\LARGE\bfseries $title$ \par\bigskip}
$endif$
$elseif(singlechapter)$
% Use chapter number and title from metadata to simulate title
$if(chapter-title)$
$if(chapter-number)$
{\centering\Huge\bfseries Chapter $chapter-number$: $chapter-title$ \par\bigskip}
% \setcounter{chapter}{\numexpr $chapter-number$ - 1 \relax}
% \chapter{$chapter-title$}
$else$
{\noindent\Huge\bfseries $chapter-title$ \par\bigskip}
% \chapter*{$chapter-title$}
$endif$
$endif$
$elseif(title)$
\maketitle
$endif$

% Pandoc include-before-body
$for(include-before)$
$include-before$
$endfor$

$if(toc)$
{
$if(singlechapter)$
% Format contents with section heading and no page break
\section*{Contents}
\startcontents
\printcontents{}{1}[$toc-depth$]{}
$else$
\setcounter{tocdepth}{$toc-depth$}
\tableofcontents
$endif$
}
$endif$

$body$

$if(showanswers)$
\ifdefvoid{\exranswerlist}{}{
  \pagebreak
  \section*{Answers to Exercises}
  \exranswerlist
}
$else$
$endif$

% Pandoc include-after-body
$for(include-after)$
$include-after$
$endfor$

\end{document}
